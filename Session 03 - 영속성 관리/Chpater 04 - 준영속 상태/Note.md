# 준영속 상태
> 작성자: 럭키/이현석

## 목차
- [준영속 상태](#준영속-상태)
  - [목차](#목차)
    - [1. 준영속 상태란](#1-준영속-상태란)
    - [2. 준영속 상태로 만드는 방법](#2-준영속-상태로-만드는-방법)

---
## 1. 준영속 상태란
<br>
영속 -> 준영속
영속 상태의 엔티티가 영속성 컨텍스트에서 분리(detached)가 되는 것이 준영속 상태. 이는 JPA가 관리하는 상태가 아니다. 영속 컨텍스트가 제공하는 기능을 사용 못한다.

<br>
+) 영속 상태가 되는 케이스는 em.persist 말고 다른 한가지가 더 있다. 
<br>데이터 조회 시, 영속성 컨텍스트(1차 캐시)에 데이터가 없는 경우, DB에서 조회해서 데이터를 찾게 되는데 이 경우에도 데이터는 영속 상태가 된다.

---
## 2. 준영속 상태로 만드는 방법
<br>

- **em.detach(entity)**: 특정 엔티티만 준영속 상태로 전환
- **em.clear()**: 영속성 컨텍스트를 완전히 초기화
- **em.close()**: 영속성 컨텍스트를 종료

<br>

```
    ```
    Member member = em.find(Member.class, 150L);
    member.setName("AAA");

    em.detach(member);

    System.out.println("==================");
    tx.commit();
    ```
```
이 경우 find를 통해 조회 쿼리는 날라가지만, update 쿼리는 실행되지 않는다.

준영속 상태에 관한 내용은 웹 어플리케이션 개발을 해볼 때 응용을 해보는 게 더 이해가 되니 지금은 이론적으로 내용만 숙지하자.