# 양방향 연관관계와 연관관계의 주인 2 - 주의점, 정리
> 작성자: @joowojr

## 목차
1. 양방향 매핑 시 가장 많이 하는 실수
2. 양방향 매핑 정리

## 1. 양방향 매핑시 가장 많이 하는 실수
- 연관관계의 주인에 값을 입력하지 않음
- 역방향 ( 주인이 아닌 방향 )만 연관관계 설정
순수한 객체 관계를 고려하면 항상 양쪽 다 값을 입력해야 한다.
    - 영속성 컨텍스트를 초기화 하지않으면 1차 캐시에 들어 있는 것이 조회돼서 반환됨
- 빠트릴 수 있기 때문에 양방향으로 설정해주는 메소드를 생성하는 것을 추천
- 양방향 매핑시에 무한 루프를 조심하자.
    - toString, lombok, json 생성 라이브러리
    - 컨트롤러에는 엔티티 반환하지 말 것.
        - 무한 루프 생성
        - 엔티티 변경 가능성 있기 때문에, 이 경우 API 스펙이 변경됨. Dto 변환 후 반환 해라

## 2.양방향 매핑 정리
- 단방향 매핑만으로도 이미 연관관계 매핑은 완료
- 양방향 매핑은 반대 방향으로 조회 ( 객체 그래프 탐색 ) 기능이 추가 된것 뿐
- JPQL 에서 역방향으로 탐색할 일이 많음
- 단방향 매핑을 잘 하고, 반대 방향은 필요할 때 추가 하면됨 ( mappedby )
    - 테이블에 영향을 주지 않기 때문에
- 연관관계의 주인을 정하는 기준
    - 비즈니스 로직 기준 x, 외래키의 위치를 기준으로 정한다.
