# 다대일 [N:1]
> 작성자: @Hyunstone

## 목차
 - [연관관계 매핑시 고려사항 3가지](#연관관계-매핑시-고려사항-3가지)
   - [다중성](#다중성)
   - [단방향, 양방향](#단방향-양방향)
   - [연관관계의 주인](#연관관계의-주인)
 - [다대일 단방향](#다대일-단방향)
 - [다대일 양방향](#다대일-양방향)
 - [Q&A](#qa)
---
### 연관관계 매핑시 고려사항 3가지

#### 다중성
 - 다대일: @ManyToOne
 - 일대다: @OneToMany
 - 일대일: @OneToOne
 - 다대다: @ManyToMany

다중성이 헷갈릴 땐 반대로 생각해보자.
대칭성이 있어 반대로 생각해보면 이해하기 쉽다. (일대다의 반대는 다대일!)

#### 단방향, 양방향
- 테이블
  - 외래 키 하나로 양쪽 조인 가능
  - 사실 방향이라는 개념이 없음
- 객체
  - 참조용 필드가 있는 쪽으로만 참조 가능
  - 한쪽만 참조하면 단방향
  - 양쪽이 서로 참조하면 양방향

#### 연관관계의 주인
 - 테이블은 외래 키 하나로 두 테이블이 연관관계를 맺음
 - 객체 양방향 관계는 A->B, B->A 처럼 참조가 2군데
 - 객체 양방향 관계는 참조가 2군데 있음. 둘중 테이블의 외래 키를 관리할 곳을 지정해야함
 - 연관관계의 주인: 외래 키를 관리하는 참조
 - 주인의 반대편: 외래 키에 영향을 주지 않음, 단순 조회만 가능

---
### 다대일 단방향
가장 많이 사용하는 연관관계<br>
관계형 DB에서는 항상 ***多***에 FK가 들어가야 설계상 맞다.
**다대일**의 반대는 **일대다**

---
### 다대일 양방향
외래 키가 있는 쪽이 연관관계의 주인<br>
양쪽을 서로 참조하도록 개발<br>
반대쪽은 조회만 하기에, 테이블에 영향이 없다.<br>
그래서 단방향으로 작성 중 필요시 객체에 추가를 통해 양방향을 구현해도 된다.

### Q&A
---
**Q: Many To One 매핑시 JoinColumn을 무조건 대상테이블의 PK로만 걸어야하는지?**

**A**: 실제로 FK로 사용할 컬럼은 참조하고자 하는 값이 Unique하다면 다른 Unique한 컬럼을 지정할 수 있습니다. ManyToOne 매핑에서 @JoinColumn을 사용할 때, 대상 테이블의 PK 이외의 Unique한 컬럼을 참조할 수 있습니다. 그러나 어떤 값을 참조하는 것이 적합한지는 사용자의 요구사항과 DB 성능 등을 고려하여 결정해야 합니다.

**Q: `@JoinColumn(name = "school_id")`라고 입력했으니까 Hibernate가 `school_id`를 참조하지 않을까 생각했습니다. Hibernate에서는 `school_id` column이 아닌 `id`를 참조했습니다.그렇다면 Hibernate에게 어떻게 `school_id`를 참조하도록 강제하도록 할 수 있을까요?**

**A**: 바로, `@JoinColumn`에 `referencedColumnName`의 값으로 참조하길 원하는 필드 이름만 넣어주면 됩니다. `referencedColumnName`의 기본값은 **Primary Key.** 즉, **따로 값을 설정해주지 않으면 자동으로 PK를 참조하게 됩니다.** PK외에 다른 필드를 참조해야 할 경우에는 반드시! 필드 이름을 넘겨줘야 합니다.